<div th:fragment="devicesSwap">
    <span
            th:attr="id=${'ticket-device-count-' + ticketId}"
            hx-swap-oob="true"
            th:text="${deviceCount}">0</span>

    <div
            th:if="${devicesOpen}"
            th:attr="id=${'ticket-device-list-' + ticketId}"
            hx-swap-oob="true"
            class="mt-3 space-y-2">
        <div th:if="${devices == null or devices.isEmpty()}" class="text-sm text-text-muted"
             th:text="#{admin.ticket.active.devices.empty}">
            No connected devices yet.
        </div>
        <ul th:if="${devices != null and !devices.isEmpty()}" class="space-y-2">
            <li th:each="device : ${devices}"
                class="flex flex-col gap-2 rounded-lg border border-border bg-surface-muted p-2">
                <div class="flex items-center justify-between gap-2">
                    <span th:if="${device.name != null and !#strings.isEmpty(device.name)}"
                          class="text-sm font-semibold"
                          th:text="${device.name}">hostname</span>
                    <span th:if="${device.name == null or #strings.isEmpty(device.name)}"
                          class="text-sm"
                          th:text="#{admin.ticket.active.devices.unknown}">Unknown hostname</span>

                    <span th:if="${kickedMacs != null and kickedMacs.contains(device.mac)}"
                          class="badge bg-brand-100 text-brand-700"
                          th:text="#{admin.ticket.active.devices.status.kicked}">Kicked</span>
                    <span th:if="${(kickedMacs == null or !kickedMacs.contains(device.mac)) and device.wasAccessRevoked}"
                          class="badge bg-danger/10 text-danger"
                          th:text="#{admin.ticket.active.devices.status.canceled}">Canceled</span>
                    <span th:if="${(kickedMacs == null or !kickedMacs.contains(device.mac)) and !device.wasAccessRevoked}"
                          class="badge bg-success/10 text-success"
                          th:text="#{admin.ticket.active.devices.status.active}">Active</span>
                </div>
                <div class="flex items-center justify-between gap-2">
                    <span class="text-text-muted font-mono text-sm" th:text="${device.mac}">AA:BB:CC:DD:EE:FF</span>
                    <button th:if="${!device.wasAccessRevoked and (kickedMacs == null or !kickedMacs.contains(device.mac))}"
                            class="btn btn-danger text-xs px-2 py-1"
                            type="button"
                            th:hx-post="@{/admin/ticket/{ticketId}/device/_kick(ticketId=${ticketId},mac=${device.mac})}"
                            th:hx-confirm="#{admin.ticket.active.devices.kick.confirm}"
                            hx-swap="none">
                        <span class="btn-text" th:text="#{admin.ticket.active.devices.kick}">Kick</span>
                        <span class="spinner"></span>
                    </button>
                </div>
            </li>
        </ul>
    </div>
</div>
